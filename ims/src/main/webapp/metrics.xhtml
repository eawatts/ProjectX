<ui:composition xmlns="https://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	template="#{current_session.loggedIn ? 'templates/template_ims.xhtml' : 'templates/template_no_access.xhtml'}">

	<meta charset="utf-8" />
	
	<ui:define name="title">Metrics</ui:define>
	
	<ui:define name="custom-css">
		<link rel="stylesheet" type="text/css" href="css/metrics.css" />
	</ui:define>

    

      

	<ui:define name="main-content">
		<div class="main-content">
			<div class="main-content">
				<div class="row">
					<h1 class="Heading">Metrics</h1>
				</div>
				<div id="hidden-content" class="dontsee">
					<ui:repeat var="product" value="#{products.productList}">
						<div class="row">
							<div class="col-tab-6 col-desk-6 name">
								<h:outputText value="#{product.name}" />
							</div>
							<div class="col-tab-6 col-desk-6 stock">
								<h:outputText value="#{product.currentStock}" />
							</div>
						</div>	
					</ui:repeat>
				</div>
				
				<h:commandButton styleClass="button-green view-button" value="PieCahrt" onclick="location.href='#popup2'"></h:commandButton>
				<div id="popup2" class="overlay">
							<div class="popup">
								<a class="close" href="#">X</a>
								<div class="content">
			<div id="piechart" style="width: 900px; height: 500px;"></div>
				</div>
							</div>
						</div>
			
			</div>
		
		</div>
	
	<script>
	//doc load
	
	//hidden-content
	
	$(document).ready(function(){
		
		var products = [];
		
		
		var axis = ['Name','Stock'];
			
			
		
		products.push(axis);
		
		
		$('#hidden-content .row').each(function(){
			
			var prodname = $(this).find('.name').text().trim();
			var prodstock = parseInt($(this).find('.stock').text().trim());
			
			var newProduct = [prodname,prodstock];
			
				
				
			
			products.push(newProduct);
		});
		
		products.forEach(function(x){
			console.log(JSON.stringify(x));
		});
		
		
		
	    google.charts.load('current', {'packages':['corechart']});
	    google.charts.setOnLoadCallback(drawChart);
	    
	    
	    function drawChart() {

    		var data = google.visualization.arrayToDataTable(products);

	        var options = {
	          title: 'Stock Levels'
	        };

	        var chart = new google.visualization.PieChart(document.getElementById('piechart'));

	        chart.draw(data, options);
        }
		
		
	});
	
	

    </script>
	
	
	
	</ui:define>
</ui:composition>